# Redis

UDTS 可以将原生 Redis 或使用代理的分布式版本（包括 UCloud Redis 分布式版、Codis、Twemproxy）作为数据源/目标 进行全量+增量任务的传输。
当前支持的版本为 3.0 至 7.0 各版本。跨大版本迁移可能存在兼容性问题，建议通过中转库迁移。例如，从3.x/4.x迁移到7.x时，需要创建5.x/6.x版本的中转库，先从3.x/4.x迁移到5.x/6.x，再从5.x/6.x迁移到7.x。

## 功能限制
- 如果源无法获取PSync权限则需要使用Rump模式迁移，当使用Rump模式做增量迁移时，源库需要设置参数`notify-keyspace-events`, 值要包含 'AE'。Rump 模式会使用 DUMP 命令来获取数据，DUMP 命令是 CPU 密集命令，会对源端造成较高压力。需要小心使用，避免影响源端实例的可用性。

## 注意事项
- 对于源和目的集群节点数目不需要一致
- 需要确保源库的 `repl-diskless-sync` 配置为 `NO`
- 如果源库为分布式版（包括 UCloud Redis 分布式版、Codis、Twemproxy），需要创建多个任务，每个任务的源库填写一个分布式节点的地址，类型选择主备版。
- 目标库为 UCloud Redis 分布式版时，目标库类型选择分布式版，地址为代理地址。
- 目标库为 UCloud Redis 分布式 Cluster 版本且提供了代理地址时，目标库类型选择分布式版，地址为代理地址。
- 目标库为 UCloud Redis 分布式 Cluster 版本且没有提供代理地址时，目标库类型选择集群版，地址为分片地址，多个地址之间用";"相连。
- 目标库为集群版时，只支持迁移db0。
- 源库为哨兵版时，源库类型选择主备版，地址需要填写备库地址。目标库为哨兵版时，目标库类型选择主备版，地址为主库地址。
- UDTS不会自动清理目标库中的数据，目标库中与源库中 Key 相同的数据会被覆盖， Key 不同的数据保留。
- Redis的过期key在到期的时候不会自动删除，一般通过惰性删除（访问该key的时候判断过期，过期就删除，否则不删除）和定期删除（定期迭代删除一定量的key），所以源库中会存在一定量的过期key，同步到目标库的时候是不会同步过期key的，所以会有数量不一致

## Redis填写表单

| 参数名           | 说明                                                                                                                        |
|------------------|---------------------------------------------------------------------------------------------------------------------------|
| 地址             | 数据库地址，只填写主(master)地址。集群模式下，多个地址用";"相连，例如：192.168.1.100:6379;192.168.1.120:6379;192.168.1.130:26379 |
| 密码             | Redis密码，非必填                                                                                                            |
| Redis类型        | 集群模式/主备模式/分布式版                                                                        |
| VPC ID           | VPC ID，redis 所属 vpc                                                                                                       |
| 所属子网         | VPC下所属子网， redis 所属子网                                                                                               |
| 是否开启Rump同步 | 当用户无 psync 权限时需要通过Rump同步。                                                                                      |